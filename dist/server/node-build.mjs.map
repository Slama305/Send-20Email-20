{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/utils/mailer.ts","../../server/routes/send-email.ts","../../server/routes/bulk-send-email.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import nodemailer from \"nodemailer\";\n\ninterface SendEmailOptions {\n  to: string;\n  recipientName: string;\n  subject: string;\n  html: string;\n}\n\ninterface SendEmailResult {\n  messageId: string;\n}\n\n// Create transporter with environment variables or demo mode\nfunction createTransporter() {\n  // Check if SMTP credentials are provided\n  const smtpHost = process.env.SMTP_HOST;\n  const smtpPort = process.env.SMTP_PORT;\n  const smtpUser = process.env.SMTP_USER;\n  const smtpPassword = process.env.SMTP_PASSWORD;\n\n  if (smtpHost && smtpPort && smtpUser && smtpPassword) {\n    // Use actual SMTP configuration\n    return nodemailer.createTransport({\n      host: smtpHost,\n      port: parseInt(smtpPort),\n      secure: process.env.SMTP_SECURE === \"true\", // true for 465, false for other ports\n      auth: {\n        user: smtpUser,\n        pass: smtpPassword,\n      },\n    });\n  }\n\n  // Use Ethereal Email (free testing service) if no SMTP config provided\n  console.warn(\n    \"No SMTP credentials found. Using Ethereal Email for testing. To use real email, set SMTP_HOST, SMTP_PORT, SMTP_USER, and SMTP_PASSWORD.\"\n  );\n\n  return nodemailer.createTestAccount().then((testAccount) => {\n    return nodemailer.createTransport({\n      host: \"smtp.ethereal.email\",\n      port: 587,\n      secure: false,\n      auth: {\n        user: testAccount.user,\n        pass: testAccount.pass,\n      },\n    });\n  });\n}\n\nexport async function sendEmailWithNodemailer(\n  options: SendEmailOptions\n): Promise<SendEmailResult> {\n  try {\n    const transporter = await createTransporter();\n\n    // Get sender email from env or use default\n    const fromEmail = process.env.FROM_EMAIL || \"noreply@emailtemplates.app\";\n    const fromName = process.env.FROM_NAME || \"Email Templates\";\n\n    const mailOptions = {\n      from: `\"${fromName}\" <${fromEmail}>`,\n      to: `\"${options.recipientName}\" <${options.to}>`,\n      subject: options.subject,\n      html: options.html,\n    };\n\n    const info = await transporter.sendMail(mailOptions);\n\n    // Log test URL for Ethereal emails\n    if (\n      process.env.NODE_ENV !== \"production\" &&\n      info.response.includes(\"250 Message accepted\")\n    ) {\n      console.log(\n        \"Ethereal preview URL:\",\n        nodemailer.getTestMessageUrl(info)\n      );\n    }\n\n    return {\n      messageId: info.messageId || \"sent\",\n    };\n  } catch (error) {\n    console.error(\"Failed to send email:\", error);\n    throw error;\n  }\n}\n","import { RequestHandler } from \"express\";\nimport { SendEmailRequest, SendEmailResponse } from \"@shared/api\";\nimport { sendEmailWithNodemailer } from \"../utils/mailer\";\n\nexport const handleSendEmail: RequestHandler = async (req, res) => {\n  try {\n    const payload = req.body as SendEmailRequest;\n\n    // Validation\n    if (!payload.recipientEmail || !payload.subject || !payload.content) {\n      res.status(400).json({\n        success: false,\n        message: \"Missing required fields: recipientEmail, subject, content\",\n      } as SendEmailResponse);\n      return;\n    }\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(payload.recipientEmail)) {\n      res.status(400).json({\n        success: false,\n        message: \"Invalid email format\",\n      } as SendEmailResponse);\n      return;\n    }\n\n    // Send email\n    const result = await sendEmailWithNodemailer({\n      to: payload.recipientEmail,\n      recipientName: payload.recipientName,\n      subject: payload.subject,\n      html: payload.content,\n    });\n\n    res.json({\n      success: true,\n      message: \"Email sent successfully\",\n      messageId: result.messageId,\n    } as SendEmailResponse);\n  } catch (error) {\n    console.error(\"Error sending email:\", error);\n    res.status(500).json({\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to send email\",\n    } as SendEmailResponse);\n  }\n};\n","import { RequestHandler } from \"express\";\nimport nodemailer from \"nodemailer\";\nimport { BulkEmailRequest, BulkEmailResponse } from \"@shared/api\";\n\nexport const handleBulkSendEmail: RequestHandler = async (req, res) => {\n  try {\n    const payload = req.body as BulkEmailRequest;\n\n    // Validation\n    if (\n      !payload.recipients ||\n      !Array.isArray(payload.recipients) ||\n      payload.recipients.length === 0\n    ) {\n      res.status(400).json({\n        success: false,\n        message: \"No recipients provided\",\n        totalSent: 0,\n        totalFailed: 0,\n        results: [],\n      } as BulkEmailResponse);\n      return;\n    }\n\n    if (!payload.subject || !payload.content || !payload.gmailEmail || !payload.appPassword) {\n      res.status(400).json({\n        success: false,\n        message: \"Missing required fields: subject, content, gmailEmail, appPassword\",\n        totalSent: 0,\n        totalFailed: 0,\n        results: [],\n      } as BulkEmailResponse);\n      return;\n    }\n\n    // Create transporter with Gmail credentials\n    const transporter = nodemailer.createTransport({\n      service: \"gmail\",\n      auth: {\n        user: payload.gmailEmail,\n        pass: payload.appPassword,\n      },\n    });\n\n    // Send emails to all recipients\n    const results = [];\n    let successCount = 0;\n    let failureCount = 0;\n\n    for (const recipient of payload.recipients) {\n      try {\n        // Validate email\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(recipient.email)) {\n          results.push({\n            email: recipient.email,\n            name: recipient.name,\n            success: false,\n            error: \"Invalid email format\",\n          });\n          failureCount++;\n          continue;\n        }\n\n        // Send email\n        await transporter.sendMail({\n          from: `\"${recipient.name}\" <${payload.gmailEmail}>`,\n          to: `\"${recipient.name}\" <${recipient.email}>`,\n          subject: payload.subject,\n          html: payload.content,\n        });\n\n        results.push({\n          email: recipient.email,\n          name: recipient.name,\n          success: true,\n        });\n        successCount++;\n      } catch (error) {\n        results.push({\n          email: recipient.email,\n          name: recipient.name,\n          success: false,\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        });\n        failureCount++;\n      }\n    }\n\n    res.json({\n      success: successCount > 0,\n      message: `Sent ${successCount} emails, ${failureCount} failed`,\n      totalSent: successCount,\n      totalFailed: failureCount,\n      results,\n    } as BulkEmailResponse);\n  } catch (error) {\n    console.error(\"Error sending bulk emails:\", error);\n    res.status(500).json({\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to send emails\",\n      totalSent: 0,\n      totalFailed: 0,\n      results: [],\n    } as BulkEmailResponse);\n  }\n};\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\nimport { handleSendEmail } from \"./routes/send-email\";\nimport { handleBulkSendEmail } from \"./routes/bulk-send-email\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json({ limit: \"50mb\" }));\n  app.use(express.urlencoded({ extended: true, limit: \"50mb\" }));\n\n  // API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n  app.post(\"/api/send-email\", handleSendEmail);\n  app.post(\"/api/bulk-send-email\", handleBulkSendEmail);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express"],"mappings":"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"}